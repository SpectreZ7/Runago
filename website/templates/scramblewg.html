{% extends "base.html" %}
{% block title %}scramblegame{% endblock %}
{% block content %}
<head>
    <style>
    .vertical-text input[type= "text"]{
        margin-top: 400px;
    }
    .vertical-text input{
        display: flex;
        flex-direction: column;
    }
    #word-input{
        font-family: 'Open Sans', sans-serif;
        font-size: 35px;
    }
    .definition-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }
    .definition-container p{
        font-family: 'Open Sans', sans-serif;
        font-size: 24px;
        color: rgb(254, 254, 254);
    }
    
    .center-content {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
    }
    body {
        font-family: 'Open Sans', sans-serif;
    }
    .error{
        color:red;
        font-weight:bold;
    }
    input[type="text"] {
        border-radius: 15px;
    }
    #definition-form {
    position: absolute;
    top: 30%;
    left: 52%;
    transform: translate(-50%, -50%);
    display: flex;
    align-items: center;
    justify-content: center;
    }
    input[type="submit"] {
        background-color: #ff0000;
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        border: none;
        font-size: 16px;
        cursor: pointer;
    }
    #add-word-button{
        background-color: #ff0000;
        color: white;
        /*please centre this button*/
        padding: 0px 55px;
        border-radius: 20px;
        border: none;
        font-size: 60px;
        cursor: pointer;

    }
    </style>
    
</head>
<form method="POST" action="{{ url_for('pages.scramblewg') }}" id="definition-form">
    <div class="center-content" style="display: flex; flex-direction: column; align-items: center;">
        <div class = "vertical-text">
            <input type="text" name="word" id="word-input" style="width: 300px; height: 50px;">
            <input type="button" value="+" style="width: 150px; height: 50px;" id="add-word-button">
        </div>
        <input type="submit" id="play-game-button" value="Play game" style="width: 150px; height: 50px; margin-top: 10px;">
    </div>
</form>

<script>
    var form = document.getElementById("definition-form");
    var input = document.getElementById("word-input");
    var error = document.createElement("p"  );
    error.classList.add("error");
    error.textContent = "Please enter a word.";
    error.style.display = "none";
    var addButton = document.getElementById("add-word-button");
    form.addEventListener("submit", function(e) {
        if (input.value === "") {
            e.preventDefault();
            input.parentNode.insertBefore(error, input.nextSibling);
            error.style.display = "block";
        }
    });
    addButton.addEventListener("click", function() {
        var newInput = document.createElement("input");
        newInput.type = "text";
        newInput.style.width = "300px";
        newInput.style.height = "50px";
        newInput.style.marginTop = "10px";
        newInput.style.marginBottom = "10px";
        newInput.style.fontSize = "35px";
        

        
        input.parentNode.insertBefore(newInput, addButton);
        
        
    }); 
    document.getElementById("play-game-button").addEventListener("click", function(event) {
        event.preventDefault();
        var words = Array.from(document.querySelectorAll(".vertical-text input[type='text']"))
            .map(function(input) { return input.value.trim(); })
            .filter(function(word) { return word.length > 0; });
        if (words.length > 0) {
            // The fetch function initiates an asynchronous HTTP request and returns a Promise. 
            // The Promise represents the eventual completion or failure of the request.
            fetch("/scrambleplay", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                    // Making a POST request to the "/scrambleplay" endpoint with JSON data.
                    // The request headers specify the content type as JSON.
                },
                body: JSON.stringify(words)
                
            })
            // Chain a promise using `then()` to handle the response from the server.
            .then(function(response) {
                // Handling the response from the server.
                if (response.ok) {
                    // Checking if the response was successful (status code 2xx).
                    return response.json();
                    // Parsing the response body as JSON.
                } else {
                    throw new Error("Network response was not ok.");
                }// Throwing an error if the response was not successful.
            })
            // Chain another promise using `then()` to handle the parsed JSON data from the previous `then()` callback.
            .then(function(data) {
                // Handling the parsed JSON data from the response.
                definitions = {}

                Object.keys(data.scrambled_definitions).forEach(word => {
                    definitions[word] = data.scrambled_definitions[word];
                });
                window.location.href = "/scrambleplay?definitions=" + encodeURIComponent(JSON.stringify(definitions));
            })
            // Chain the `catch()` method to handle any errors that occur in the promise chain.
            .catch(function(error) {
                console.error("Error:", error);
            });
        }
    });
    
    
      



</script>


{% endblock %}